name: "Continuos Integration Wrapper"
description: "Este archivo de pipeline de CI/CD es una plantilla genérica diseñada para soportar múltiples tecnologías y frameworks. Su objetivo es automatizar los pasos de integración y despliegue para proyectos de software, garantizando un proceso de desarrollo y entrega eficiente y consistente."

inputs:
  # Github
  github_username:
    description: "usuario de github para autenticarse en los packages"
    required: true
  github_token:
    description: "token del usuario con permisos de lectura en packages"
    required: true

  # Directories
  workdir_src:
    description: "directorio donde se encuentra el project a compilar DEFAULT: ./"
    required: false
    default: './'
  workdir_test:
    description: "directorio donde se encuentra los test DEFAULT: ./"
    required: false
    default: './'

  # Sonarqube
  sonar_url: 
    description: "url sonarqube"
    required: true
  sonar_token: 
    description: "token sonarqube"
    required: true
  sonar_custom:
    description: "config sonar custom"
    default: ""
    required: false
  sonar_tags:
    description: "extra tags, ej: 'react-18, microfrontend'"
    default: ""
    required: false

  matrix_version:
    description: "matrix de pruebas node"
    required: false
    default: ""

  ## Build React
  fontawesome_token: 
    description: "token de fontawesome"
    required: false
    default: ''
runs:
  using: "composite"
  steps:
    - name: Checkout
      uses: actions/checkout@v4

    - uses: architecture-it/actions@react-base-library
      with:
        matrix_version:  ${{ inputs.matrix_version }}
        skip_test: 'false'
        # secrets enabled in all organizations
        packages_token: ${{ inputs.github_token }}
        fontawesome_token: ${{ inputs.fontawesome_token }}

    - name: Lint
      run: yarn eslint
      shell: bash

    - name: Unit tests
      run: yarn test --coverage
      shell: bash
      env:
        CI: ${{ env.CI == 'true' }}

    - name: Archive code coverage results
      uses: actions/upload-artifact@v3
      with:
        name: code-coverage-report
        path: coverage

    - name: "SonarQube Analyzer"
      uses: architecture-it/actions@sonarqube
      with:
        sonar_url: ${{ inputs.sonar_url }}
        sonar_token: ${{ inputs.sonar_token }}
        tags: ${{ inputs.sonar_tags }}
        sonar_custom: ${{ inputs.sonar_custom }}
        sonar_code: 'React Native'
          

